# ğŸ”’ OpenClaw å®‰å…¨é…ç½®æŒ‡å—

> **å‘é‡æª¢ç´¢æ¨™ç±¤**ï¼š`security`, `api-key`, `docker`, `sandbox`, `å®‰å…¨`, `ç”Ÿç”¢ç’°å¢ƒ`

---

## ğŸ“‹ å®‰å…¨æª¢æŸ¥æ¸…å–®

| é …ç›® | é‡è¦æ€§ | ç‹€æ…‹ |
|------|--------|------|
| API é‡‘é‘°ä¸å¯«å…¥ä»£ç¢¼ | ğŸ”´ å¿…é ˆ | â˜ |
| ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ– Secrets | ğŸ”´ å¿…é ˆ | â˜ |
| Docker å®¹å™¨éš”é›¢ | ğŸŸ¡ æ¨è–¦ | â˜ |
| é™åˆ¶ç¶²è·¯è¨ªå• | ğŸŸ¡ æ¨è–¦ | â˜ |
| å•Ÿç”¨å¯©è¨ˆæ—¥èªŒ | ğŸŸ¢ é¸ç”¨ | â˜ |
| å®šæœŸè¼ªæ›é‡‘é‘° | ğŸŸ¢ é¸ç”¨ | â˜ |

---

## ğŸ”‘ API é‡‘é‘°ç®¡ç†

### âŒ éŒ¯èª¤åšæ³•

```javascript
// åƒè¬ä¸è¦é€™æ¨£åšï¼
const apiKey = "sk-ant-api03-xxxxx";
```

### âœ… æ­£ç¢ºåšæ³•

#### æ–¹å¼ä¸€ï¼šç’°å¢ƒè®Šæ•¸

```bash
# è¨­ç½®ç’°å¢ƒè®Šæ•¸
export ANTHROPIC_API_KEY="sk-ant-..."
export OPENAI_API_KEY="sk-..."

# åœ¨ .zshrc ä¸­æŒä¹…åŒ–ï¼ˆä½†ä¸è¦æäº¤åˆ° gitï¼‰
echo 'export ANTHROPIC_API_KEY="sk-ant-..."' >> ~/.zshrc
```

#### æ–¹å¼äºŒï¼š.env æ–‡ä»¶ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰

```bash
# .env æ–‡ä»¶ï¼ˆå¿…é ˆåŠ å…¥ .gitignoreï¼‰
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=AIza...
```

```bash
# .gitignore
.env
.env.local
*.key
```

#### æ–¹å¼ä¸‰ï¼šDocker Secretsï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

```bash
# å‰µå»º secret
echo "sk-ant-..." | docker secret create anthropic_api_key -

# åœ¨ docker-compose.yml ä¸­ä½¿ç”¨
services:
  openclaw:
    secrets:
      - anthropic_api_key
    environment:
      - ANTHROPIC_API_KEY_FILE=/run/secrets/anthropic_api_key

secrets:
  anthropic_api_key:
    external: true
```

#### æ–¹å¼å››ï¼šKubernetes Secrets

```bash
# å‰µå»º Secret
kubectl create secret generic openclaw-secrets \
  --from-literal=anthropic-api-key="sk-ant-..." \
  --from-literal=openai-api-key="sk-..."

# åœ¨ Pod ä¸­å¼•ç”¨
env:
- name: ANTHROPIC_API_KEY
  valueFrom:
    secretKeyRef:
      name: openclaw-secrets
      key: anthropic-api-key
```

---

## ğŸ³ Docker å®‰å…¨éš”é›¢

### åŸºç¤éš”é›¢é…ç½®

```yaml
# docker-compose.yml
services:
  openclaw-gateway:
    image: openclaw/openclaw:latest
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
```

### ç¶²è·¯éš”é›¢

```yaml
# å‰µå»ºéš”é›¢ç¶²è·¯
networks:
  openclaw-internal:
    driver: bridge
    internal: true  # ç¦æ­¢å¤–éƒ¨è¨ªå•

services:
  openclaw-gateway:
    networks:
      - openclaw-internal
      - frontend  # åªæš´éœ²å¿…è¦æ¥å£
```

### è³‡æºé™åˆ¶

```yaml
services:
  openclaw-gateway:
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
```

---

## ğŸŒ ç¶²è·¯å®‰å…¨

### é˜²ç«ç‰†è¦å‰‡ï¼ˆufwï¼‰

```bash
# åªå…è¨±æœ¬åœ°è¨ªå•
sudo ufw allow from 127.0.0.1 to any port 18789

# æˆ–åªå…è¨±ç‰¹å®š IP
sudo ufw allow from 192.168.1.0/24 to any port 18789
```

### Nginx åå‘ä»£ç†ï¼ˆæ¨è–¦ï¼‰

```nginx
# /etc/nginx/sites-available/openclaw
server {
    listen 443 ssl;
    server_name openclaw.yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/openclaw.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/openclaw.yourdomain.com/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:18789;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_cache_bypass $http_upgrade;
        
        # é€Ÿç‡é™åˆ¶
        limit_req zone=openclaw burst=20 nodelay;
    }
}

# åœ¨ http å€å¡Šä¸­å®šç¾©é€Ÿç‡é™åˆ¶
limit_req_zone $binary_remote_addr zone=openclaw:10m rate=10r/s;
```

---

## ğŸ“ å¯©è¨ˆæ—¥èªŒ

### å•Ÿç”¨å¯©è¨ˆæ—¥èªŒ

```json
// openclaw.json
{
  "security": {
    "audit": {
      "enabled": true,
      "logFile": "/var/log/openclaw/audit.log",
      "logLevel": "info",
      "includeRequests": true,
      "includeResponses": false,
      "redactKeys": ["api_key", "password", "token"]
    }
  }
}
```

### æ—¥èªŒè¼ªæ›

```bash
# /etc/logrotate.d/openclaw
/var/log/openclaw/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 openclaw openclaw
    sharedscripts
    postrotate
        docker kill -s USR1 openclaw-gateway 2>/dev/null || true
    endscript
}
```

---

## ğŸ”„ é‡‘é‘°è¼ªæ›ç­–ç•¥

### è‡ªå‹•è¼ªæ›è…³æœ¬

```bash
#!/bin/bash
# rotate-keys.sh

# å¾å®‰å…¨å­˜å„²ç²å–æ–°é‡‘é‘°
NEW_KEY=$(vault kv get -field=api_key secret/openclaw/anthropic)

# æ›´æ–° Docker secret
echo "$NEW_KEY" | docker secret create anthropic_api_key_new -

# æ›´æ–°æœå‹™
docker service update \
  --secret-rm anthropic_api_key \
  --secret-add anthropic_api_key_new \
  openclaw-gateway

# åˆªé™¤èˆŠ secret
docker secret rm anthropic_api_key

# é‡å‘½åæ–° secret
# (Docker ä¸æ”¯æŒé‡å‘½åï¼Œéœ€è¦åœ¨ä¸‹æ¬¡è¼ªæ›æ™‚è™•ç†)
```

### è¼ªæ›é »ç‡å»ºè­°

| é‡‘é‘°é¡å‹ | å»ºè­°é »ç‡ |
|----------|----------|
| API é‡‘é‘° | 90 å¤© |
| JWT Secret | 30 å¤© |
| æ•¸æ“šåº«å¯†ç¢¼ | 90 å¤© |

---

## ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å¯¦è¸æ‘˜è¦

1. **æ°¸é ä¸è¦**ï¼šåœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼ API é‡‘é‘°
2. **æ°¸é ä¸è¦**ï¼šå°‡ .env æ–‡ä»¶æäº¤åˆ° git
3. **æ°¸é ä½¿ç”¨**ï¼šç’°å¢ƒè®Šæ•¸æˆ– Secrets ç®¡ç†é‡‘é‘°
4. **æ°¸é ä½¿ç”¨**ï¼šDocker å®¹å™¨éš”é›¢ç”Ÿç”¢ç’°å¢ƒ
5. **å®šæœŸ**ï¼šè¼ªæ› API é‡‘é‘°
6. **å®šæœŸ**ï¼šå¯©æŸ¥å¯©è¨ˆæ—¥èªŒ

---

*æ–‡æª”ç‰ˆæœ¬ï¼š1.0*
