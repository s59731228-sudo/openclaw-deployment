# ğŸ§  å‘é‡è³‡æ–™åº«æ•´åˆæŒ‡å—

> **å‘é‡æª¢ç´¢æ¨™ç±¤**ï¼š`vector`, `embedding`, `memory`, `search`, `sqlite-vec`, `chromadb`, `å‘é‡`, `åµŒå…¥`, `è¨˜æ†¶ç³»çµ±`
> **è³‡æ–™ä¾†æº**ï¼šOpenClaw å®˜æ–¹æ–‡æª” + Soul System å¯¦æˆ°

---

## ğŸ“‹ å‘é‡è³‡æ–™åº«ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‘é‡è³‡æ–™åº«æ¶æ§‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ–‡æœ¬/å°è©±/è¨˜æ†¶                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Embedding æ¨¡å‹                            â”‚   â”‚
â”‚  â”‚  OpenAI â”‚ Gemini â”‚ Local (embeddinggemma)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  å‘é‡è³‡æ–™åº«                                â”‚   â”‚
â”‚  â”‚  sqlite-vec â”‚ ChromaDB â”‚ Pinecone â”‚ Weaviate            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              æ··åˆæœç´¢ (Hybrid Search)                      â”‚   â”‚
â”‚  â”‚         å‘é‡ç›¸ä¼¼åº¦ (0.7) + BM25 æ–‡å­—åŒ¹é… (0.3)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ OpenClaw å…§å»ºè¨˜æ†¶ç³»çµ±

### æ¶æ§‹èªªæ˜

OpenClaw ä½¿ç”¨ **sqlite-vec** ä½œç‚ºå…§å»ºå‘é‡è³‡æ–™åº«ï¼Œæ”¯æ´ï¼š
- å‘é‡ç›¸ä¼¼åº¦æœç´¢
- BM25 æ–‡å­—åŒ¹é…
- æ··åˆæœç´¢ï¼ˆHybrid Searchï¼‰

### é…ç½®ç¯„ä¾‹

```json5
// ~/.openclaw/openclaw.json
{
  "agents": {
    "defaults": {
      "memorySearch": {
        "enabled": true,
        
        // Embedding æä¾›è€…
        "provider": "auto",           // "openai" | "gemini" | "local" | "auto"
        "model": "text-embedding-3-small",  // OpenAI åµŒå…¥æ¨¡å‹
        
        // æœç´¢ä¾†æº
        "sources": ["memory"],        // ["memory"] | ["sessions"] | ["memory", "sessions"]
        
        // æœç´¢é…ç½®
        "query": {
          "maxResults": 6,            // æœ€å¤§è¿”å›æ•¸
          "minScore": 0.35,           // æœ€ä½ç›¸é—œåˆ†æ•¸
          
          // æ··åˆæœç´¢
          "hybrid": {
            "enabled": true,
            "vectorWeight": 0.7,      // å‘é‡æ¬Šé‡
            "textWeight": 0.3         // æ–‡å­—æ¬Šé‡
          }
        },
        
        // åŒæ­¥ç­–ç•¥
        "sync": {
          "onSessionStart": true,     // æœƒè©±é–‹å§‹æ™‚åŒæ­¥
          "onSearch": true,           // æœç´¢æ™‚åŒæ­¥
          "watch": true,              // ç›£è½æª”æ¡ˆè®ŠåŒ–
          "watchDebounceMs": 1500     // é˜²æŠ–æ™‚é–“
        },
        
        // å‚™ç”¨æä¾›è€…
        "fallback": "openai"
      }
    }
  }
}
```

### è¨˜æ†¶æª”æ¡ˆçµæ§‹

```
~/.openclaw/
â”œâ”€â”€ workspace/
â”‚   â”œâ”€â”€ MEMORY.md              # é•·æœŸè¨˜æ†¶ï¼ˆæ‰‹å‹•ç¶­è­·ï¼‰
â”‚   â””â”€â”€ memory/                # æ¯æ—¥æ—¥èªŒ
â”‚       â”œâ”€â”€ 2026-02-01.md
â”‚       â”œâ”€â”€ 2026-02-02.md
â”‚       â””â”€â”€ 2026-02-03.md
â””â”€â”€ memory/
    â””â”€â”€ {agentId}.sqlite       # å‘é‡è³‡æ–™åº«
```

### CLI æŒ‡ä»¤

```bash
# æŸ¥çœ‹è¨˜æ†¶ç‹€æ…‹
openclaw memory status

# æ·±åº¦æª¢æŸ¥ï¼ˆæ¢æ¸¬å‘é‡è³‡æ–™åº«ï¼‰
openclaw memory status --deep

# å»ºç«‹/æ›´æ–°ç´¢å¼•
openclaw memory index

# æœç´¢è¨˜æ†¶
openclaw memory search "é—œéµè©"

# æœç´¢ä¸¦é¡¯ç¤ºè©³æƒ…
openclaw memory search "é—œéµè©" --verbose
```

---

## 2ï¸âƒ£ æœ¬åœ°åµŒå…¥ï¼ˆé›¢ç·šé‹è¡Œï¼‰

### é©ç”¨å ´æ™¯
- å®Œå…¨é›¢ç·šç’°å¢ƒ
- éš±ç§æ•æ„Ÿè³‡æ–™
- ç¯€çœ API æˆæœ¬

### é…ç½®ç¯„ä¾‹

```json5
{
  "agents": {
    "defaults": {
      "memorySearch": {
        "enabled": true,
        "provider": "local",
        
        // æœ¬åœ°æ¨¡å‹é…ç½®
        "local": {
          // æ¨¡å‹è·¯å¾‘ï¼ˆè‡ªå‹•ä¸‹è¼‰ï¼‰
          "modelPath": "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf",
          
          // å¿«å–ç›®éŒ„
          "modelCacheDir": "~/.cache/llama",
          
          // æ¨¡å‹åƒæ•¸
          "contextSize": 512,
          "batchSize": 512
        }
      }
    }
  }
}
```

### æ¨è–¦æœ¬åœ°æ¨¡å‹

| æ¨¡å‹ | å¤§å° | ç¶­åº¦ | å“è³ª | é€Ÿåº¦ |
|------|------|------|------|------|
| embeddinggemma-300M | 600 MB | 256 | â­â­â­ | â­â­â­â­â­ |
| nomic-embed-text | 274 MB | 768 | â­â­â­â­ | â­â­â­â­ |
| all-MiniLM-L6-v2 | 91 MB | 384 | â­â­â­ | â­â­â­â­â­ |

### å®‰è£æœ¬åœ°åµŒå…¥ä¾è³´

```bash
# å®‰è£ llama-cpp-embeddings
npm install llama-cpp-embeddings

# æˆ–ä½¿ç”¨ Python
pip install sentence-transformers
```

---

## 3ï¸âƒ£ èˆ‡ Soul System æ•´åˆ

### æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Soul System è¨˜æ†¶æ¶æ§‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ€ç¶­ç†”çˆ      â”‚    â”‚  Soul API      â”‚    â”‚  OpenClaw     â”‚ â”‚
â”‚  â”‚  THOUGHT_FORGE â”‚â—€â”€â”€â–¶â”‚  localhost:8531â”‚â—€â”€â”€â–¶â”‚  Memory       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                      â”‚                      â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                â”‚                                 â”‚
â”‚                                â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  çµ±ä¸€å‘é‡ç´¢å¼•                              â”‚   â”‚
â”‚  â”‚  ~/Documents/æ€ç¶­ç†”çˆ/data/soul_api.db (sqlite-vec)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Soul API è¨˜æ†¶æŸ¥è©¢

```bash
# æŸ¥è©¢ç›¸é—œè¨˜æ†¶
curl -X POST http://localhost:8531/soul/query \
  -H "Content-Type: application/json" \
  -d '{"query": "OpenClaw éƒ¨ç½²", "limit": 5}'

# å›æ‡‰æ ¼å¼
{
  "results": [
    {
      "content": "...",
      "score": 0.85,
      "source": "THOUGHT_FORGE.md",
      "timestamp": "2026-02-04"
    }
  ]
}
```

### æ•´åˆé…ç½®

```json5
// ~/.openclaw/openclaw.json
{
  "agents": {
    "defaults": {
      "memorySearch": {
        "enabled": true,
        
        // ä½¿ç”¨ Soul API ä½œç‚ºè¨˜æ†¶å¾Œç«¯
        "provider": "custom",
        "custom": {
          "endpoint": "http://localhost:8531/soul/search",
          "method": "POST",
          "headers": {
            "Content-Type": "application/json"
          },
          "bodyTemplate": {
            "query": "{{query}}",
            "limit": "{{maxResults}}"
          }
        }
      }
    }
  }
}
```

---

## 4ï¸âƒ£ è‡ªå»ºå‘é‡è³‡æ–™åº«

### æ–¹æ¡ˆ Aï¼šChromaDB

é©åˆä¸­å°å‹å°ˆæ¡ˆï¼ŒPython ç”Ÿæ…‹ç³»çµ±ã€‚

```python
# å®‰è£
pip install chromadb

# ä½¿ç”¨
import chromadb
from chromadb.utils import embedding_functions

# åˆå§‹åŒ–
client = chromadb.PersistentClient(path="./chroma_db")

# ä½¿ç”¨ OpenAI åµŒå…¥
openai_ef = embedding_functions.OpenAIEmbeddingFunction(
    api_key=os.environ["OPENAI_API_KEY"],
    model_name="text-embedding-3-small"
)

# å»ºç«‹é›†åˆ
collection = client.get_or_create_collection(
    name="memories",
    embedding_function=openai_ef,
    metadata={"hnsw:space": "cosine"}
)

# æ–°å¢æ–‡æª”
collection.add(
    ids=["doc1", "doc2"],
    documents=["æ–‡æª”å…§å®¹ 1", "æ–‡æª”å…§å®¹ 2"],
    metadatas=[{"source": "file1"}, {"source": "file2"}]
)

# æœç´¢
results = collection.query(
    query_texts=["æœç´¢é—œéµè©"],
    n_results=5
)
```

### æ–¹æ¡ˆ Bï¼šsqlite-vec

é©åˆåµŒå…¥å¼å ´æ™¯ï¼Œç„¡éœ€é¡å¤–æœå‹™ã€‚

```python
# å®‰è£
pip install sqlite-vec

# ä½¿ç”¨
import sqlite3
import sqlite_vec

# åˆå§‹åŒ–
db = sqlite3.connect("memories.db")
db.enable_load_extension(True)
sqlite_vec.load(db)

# å»ºç«‹è¡¨
db.execute("""
    CREATE VIRTUAL TABLE IF NOT EXISTS memories USING vec0(
        embedding float[384],
        +content TEXT,
        +source TEXT,
        +timestamp TEXT
    )
""")

# æ’å…¥å‘é‡
db.execute(
    "INSERT INTO memories (embedding, content, source, timestamp) VALUES (?, ?, ?, ?)",
    [embedding_bytes, content, source, timestamp]
)

# æœç´¢
results = db.execute("""
    SELECT content, source, distance
    FROM memories
    WHERE embedding MATCH ?
    ORDER BY distance
    LIMIT 5
""", [query_embedding_bytes]).fetchall()
```

### æ–¹æ¡ˆ Cï¼šPineconeï¼ˆé›²ç«¯ï¼‰

é©åˆå¤§è¦æ¨¡ã€åˆ†æ•£å¼å ´æ™¯ã€‚

```python
# å®‰è£
pip install pinecone-client

# ä½¿ç”¨
from pinecone import Pinecone

pc = Pinecone(api_key=os.environ["PINECONE_API_KEY"])
index = pc.Index("memories")

# æ’å…¥
index.upsert(vectors=[
    {"id": "doc1", "values": embedding, "metadata": {"content": "..."}}
])

# æœç´¢
results = index.query(
    vector=query_embedding,
    top_k=5,
    include_metadata=True
)
```

---

## 5ï¸âƒ£ Embedding æ¨¡å‹é¸æ“‡

### é›²ç«¯æ¨¡å‹

| æ¨¡å‹ | ç¶­åº¦ | åƒ¹æ ¼/1M tokens | å“è³ª | æ¨è–¦ç”¨é€” |
|------|------|----------------|------|----------|
| text-embedding-3-small | 1536 | $0.02 | â­â­â­â­ | ä¸€èˆ¬ç”¨é€” |
| text-embedding-3-large | 3072 | $0.13 | â­â­â­â­â­ | é«˜ç²¾åº¦ |
| text-embedding-ada-002 | 1536 | $0.10 | â­â­â­ | èˆŠç‰ˆç›¸å®¹ |
| gemini-embedding-001 | 768 | å…è²»ï¼ˆæœ‰é™é¡ï¼‰| â­â­â­â­ | æˆæœ¬æ•æ„Ÿ |

### æœ¬åœ°æ¨¡å‹

| æ¨¡å‹ | ç¶­åº¦ | å¤§å° | é€Ÿåº¦ | æ¨è–¦å ´æ™¯ |
|------|------|------|------|----------|
| embeddinggemma-300M | 256 | 600MB | â­â­â­â­â­ | é›¢ç·šã€å¿«é€Ÿ |
| nomic-embed-text | 768 | 274MB | â­â­â­â­ | å¹³è¡¡ |
| bge-large-zh | 1024 | 1.3GB | â­â­â­ | ä¸­æ–‡å„ªåŒ– |

### é…ç½®ç¯„ä¾‹

```json5
{
  "agents": {
    "defaults": {
      "memorySearch": {
        // é›²ç«¯å„ªå…ˆï¼Œæœ¬åœ°å‚™æ´
        "provider": "auto",
        "model": "text-embedding-3-small",
        
        // æœ¬åœ°å‚™æ´é…ç½®
        "local": {
          "modelPath": "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf"
        },
        
        // å‚™æ´é †åº
        "fallback": "local"
      }
    }
  }
}
```

---

## 6ï¸âƒ£ æ··åˆæœç´¢ç­–ç•¥

### ä»€éº¼æ˜¯æ··åˆæœç´¢ï¼Ÿ

çµåˆ**å‘é‡ç›¸ä¼¼åº¦**å’Œ**BM25 æ–‡å­—åŒ¹é…**ï¼Œæå‡æœç´¢å“è³ªã€‚

```
æŸ¥è©¢: "OpenClaw éƒ¨ç½²æœ€ä½³å¯¦è¸"
        â”‚
        â”œâ”€ å‘é‡æœç´¢: æ‰¾èªç¾©ç›¸è¿‘çš„æ–‡æª”
        â”‚   â””â”€ "AI åŠ©æ‰‹å®‰è£æŒ‡å—" (score: 0.82)
        â”‚
        â””â”€ BM25 æœç´¢: æ‰¾é—œéµå­—åŒ¹é…çš„æ–‡æª”
            â””â”€ "OpenClaw éƒ¨ç½²æ•™å­¸" (score: 0.75)
        â”‚
        â–¼
    åŠ æ¬Šåˆä½µ (vector:0.7 + text:0.3)
        â”‚
        â–¼
    æœ€çµ‚æ’åºçµæœ
```

### é…ç½®ç¯„ä¾‹

```json5
{
  "memorySearch": {
    "query": {
      "hybrid": {
        "enabled": true,
        "vectorWeight": 0.7,    // å‘é‡æ¬Šé‡
        "textWeight": 0.3,      // BM25 æ¬Šé‡
        
        // é€²éšè¨­å®š
        "rerank": {
          "enabled": true,       // é‡æ–°æ’åº
          "model": "cohere-rerank"
        }
      }
    }
  }
}
```

### æ¬Šé‡èª¿æ•´å»ºè­°

| å ´æ™¯ | å‘é‡æ¬Šé‡ | æ–‡å­—æ¬Šé‡ | èªªæ˜ |
|------|----------|----------|------|
| ä¸€èˆ¬æœç´¢ | 0.7 | 0.3 | å¹³è¡¡èªç¾©å’Œé—œéµå­— |
| æŠ€è¡“æ–‡æª” | 0.5 | 0.5 | é—œéµå­—é‡è¦ |
| å°è©±è¨˜æ†¶ | 0.8 | 0.2 | èªç¾©å„ªå…ˆ |
| ä»£ç¢¼æœç´¢ | 0.3 | 0.7 | ç²¾ç¢ºåŒ¹é…é‡è¦ |

---

## 7ï¸âƒ£ å¯¦æˆ°ç¯„ä¾‹

### ç¯„ä¾‹ Aï¼šæ—¥è¨˜è¨˜æ†¶ç³»çµ±

```python
"""
æ¯æ—¥å°è©±æ‘˜è¦ â†’ å‘é‡ç´¢å¼• â†’ è¨˜æ†¶æœç´¢
"""
from datetime import datetime
import sqlite3
import sqlite_vec
from openai import OpenAI

client = OpenAI()
db = sqlite3.connect("diary.db")
sqlite_vec.load(db)

# å»ºç«‹è¨˜æ†¶è¡¨
db.execute("""
    CREATE VIRTUAL TABLE IF NOT EXISTS diary USING vec0(
        embedding float[1536],
        +date TEXT,
        +summary TEXT,
        +mood TEXT
    )
""")

def add_diary_entry(summary: str, mood: str = "neutral"):
    """æ–°å¢æ—¥è¨˜æ¢ç›®"""
    # ç”¢ç”ŸåµŒå…¥
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=summary
    )
    embedding = response.data[0].embedding
    
    # å­˜å…¥è³‡æ–™åº«
    db.execute(
        "INSERT INTO diary VALUES (?, ?, ?, ?)",
        [bytes(embedding), datetime.now().isoformat(), summary, mood]
    )
    db.commit()

def search_memories(query: str, limit: int = 5):
    """æœç´¢ç›¸é—œè¨˜æ†¶"""
    # æŸ¥è©¢åµŒå…¥
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=query
    )
    query_embedding = response.data[0].embedding
    
    # å‘é‡æœç´¢
    results = db.execute("""
        SELECT date, summary, mood, distance
        FROM diary
        WHERE embedding MATCH ?
        ORDER BY distance
        LIMIT ?
    """, [bytes(query_embedding), limit]).fetchall()
    
    return results

# ä½¿ç”¨
add_diary_entry("ä»Šå¤©å®Œæˆäº† OpenClaw éƒ¨ç½²æ•™å­¸å°ˆæ¡ˆ", "happy")
memories = search_memories("éƒ¨ç½²ç›¸é—œçš„å·¥ä½œ")
```

### ç¯„ä¾‹ Bï¼šä»£ç¢¼çŸ¥è­˜åº«

```python
"""
ä»£ç¢¼ç‰‡æ®µ â†’ å‘é‡ç´¢å¼• â†’ èªç¾©æœç´¢
"""
import chromadb
from chromadb.utils import embedding_functions

# åˆå§‹åŒ–
client = chromadb.PersistentClient(path="./code_kb")
openai_ef = embedding_functions.OpenAIEmbeddingFunction(
    api_key=os.environ["OPENAI_API_KEY"],
    model_name="text-embedding-3-small"
)

collection = client.get_or_create_collection(
    name="code_snippets",
    embedding_function=openai_ef
)

def index_code_file(file_path: str):
    """ç´¢å¼•ä»£ç¢¼æª”æ¡ˆ"""
    with open(file_path) as f:
        content = f.read()
    
    # åˆ†å‰²æˆå‡½æ•¸/é¡åˆ¥
    chunks = split_code(content)
    
    for i, chunk in enumerate(chunks):
        collection.add(
            ids=[f"{file_path}:{i}"],
            documents=[chunk['code']],
            metadatas=[{
                "file": file_path,
                "type": chunk['type'],
                "name": chunk['name']
            }]
        )

def search_code(query: str, language: str = None):
    """æœç´¢ä»£ç¢¼"""
    where_filter = {"type": language} if language else None
    
    results = collection.query(
        query_texts=[query],
        n_results=5,
        where=where_filter
    )
    
    return results
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [06-è¨˜æ†¶ç³»çµ±.md](./06-è¨˜æ†¶ç³»çµ±.md)
- [10-Soul-Systemå‘é‡æ•´åˆ.md](./10-Soul-Systemå‘é‡æ•´åˆ.md)
- [12-è¼ªè©¢ç­–ç•¥æœ€ä½³å¯¦è¸.md](./12-è¼ªè©¢ç­–ç•¥æœ€ä½³å¯¦è¸.md)

---

*æœ€å¾Œæ›´æ–°ï¼š2026-02-04*
