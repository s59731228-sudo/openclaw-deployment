# 🧠 OpenClaw 記憶系統

> **向量檢索標籤**：`memory`, `soul`, `context`, `vector`, `記憶`, `人格`

---

## 📋 記憶系統概述

OpenClaw 的記憶系統包含兩個核心檔案：

| 檔案 | 用途 | 更新頻率 |
|------|------|----------|
| **SOUL.md** | 定義 AI 人格、行為準則 | 較少更新 |
| **MEMORY.md** | 儲存長期記憶、專案知識 | 頻繁更新 |

---

## 👻 SOUL.md（人格配置）

### 檔案位置
```
~/.openclaw/SOUL.md
```

### 基本結構

```markdown
# AI 人格配置

## 身份定義

你是 [名稱]，專精於 [領域]。

### 核心特質
- **高效**：直接回答，不囉嗦
- **準確**：先驗證再陳述
- **誠實**：承認不確定的事

---

## 溝通風格

### 語言偏好
- 主要語言：繁體中文
- 技術用語：保持英文
- 語氣：專業但友善

### 回應格式
- 預設：簡潔（3-5 句）
- 複雜問題：結構化標題
- 程式碼：永遠加註解

### 禁止用語
- "Great question!"
- "I'd be happy to..."
- "As an AI language model..."

---

## 決策原則

### 優先順序
1. 安全：不妥協
2. 準確：先驗證
3. 效率：減少用戶負擔

### 不確定時
- 說明信心程度
- 提供替代方案
- 適度詢問（不過度）

---

## 工作流偏好

### 程式碼修改
1. 先讀現有程式碼
2. 匹配專案風格
3. 最小化修改
4. 測試驗證

### Git 提交
- 只在用戶要求時提交
- 描述性訊息
- 永不 force push 到 main
```

---

## 📚 MEMORY.md（長期記憶）

### 檔案位置
```
~/.openclaw/MEMORY.md
```

### 基本結構

```markdown
# 長期記憶存儲

## 對話歷史摘要

### 最近對話
| 日期 | 主題 | 關鍵決策 |
|------|------|----------|
| 2026-02-04 | OpenClaw 部署 | 選擇 Docker 方式 |

---

## 專案知識

### 進行中專案
```yaml
projects:
  - name: "歪歪工作流"
    path: "~/Documents/歪歪工作流初版"
    stack: ["Python", "SQLite", "Streamlit"]
    status: active
```

---

## 用戶偏好（學習到的）

### 程式碼風格
- 縮排：4 空格（Python）
- 引號：雙引號
- 註解：中文可以

### 溝通偏好
- 回應長度：簡潔為主
- Emoji：少用
- 技術深度：高

---

## 領域知識

### 業務背景
- 公司：源洋制服
- 產業：服裝製造
- 關鍵術語：
  - 合約：客戶訂單合約
  - 款式：服裝設計款式

---

## 重要決策日誌

| 日期 | 決策 | 原因 |
|------|------|------|
| 2026-01-20 | 使用 SQLite | 簡單、便攜 |

---

## 快速參考

### 常用指令
```bash
# 啟動歪歪工作流
cd ~/Documents/歪歪工作流初版 && streamlit run app/main.py
```

### 重要路徑
- 主專案：`~/Documents/歪歪工作流初版/`
- 思維熔爐：`~/Documents/思維熔爐/`
- 技能目錄：`~/.claude/skills/`
```

---

## 🔍 向量檢索整合

### 與 Soul System 整合

記憶系統的內容可被 Soul System 向量檢索：

```python
# Soul API 查詢記憶
curl http://localhost:8531/soul/query \
  -H "Content-Type: application/json" \
  -d '{"query": "歪歪工作流用什麼技術棧"}'
```

### 向量標籤格式

在文檔中加入向量檢索標籤：

```yaml
vector_tags:
  - memory
  - project
  - 專案名稱
```

---

## 🔄 記憶同步機制

### 自動同步

OpenClaw 可配置自動同步到向量資料庫：

```json
{
  "memory": {
    "enabled": true,
    "autoSync": true,
    "vectorDb": {
      "type": "qdrant",
      "url": "http://localhost:6333",
      "collection": "openclaw-memory"
    },
    "syncInterval": 300
  }
}
```

### 手動同步

```bash
openclaw memory sync
openclaw memory export --format json
openclaw memory import ./backup.json
```

---

## 📏 上下文視窗管理

### 視窗大小設定

```json
{
  "memory": {
    "contextWindow": {
      "maxTokens": 128000,
      "reserveForOutput": 8000,
      "priorityOrder": ["recent", "relevant", "pinned"]
    }
  }
}
```

### 優先級說明

| 優先級 | 說明 |
|--------|------|
| **recent** | 最近的對話內容 |
| **relevant** | 與當前查詢相關的記憶 |
| **pinned** | 用戶標記為重要的內容 |

---

## 🛠️ 最佳實踐

### SOUL.md
1. **保持穩定**：人格設定不要頻繁改動
2. **具體明確**：避免模糊的指令
3. **測試效果**：修改後驗證 AI 行為

### MEMORY.md
1. **結構化存儲**：使用表格和 YAML
2. **定期清理**：移除過時資訊
3. **向量友好**：加入檢索標籤

---

## ❓ 常見問題

### Q: AI 忘記之前的對話？

檢查 MEMORY.md 是否正確載入：
```bash
openclaw memory show
```

### Q: 如何重置人格？

備份後刪除 SOUL.md：
```bash
cp ~/.openclaw/SOUL.md ~/.openclaw/SOUL.md.backup
rm ~/.openclaw/SOUL.md
openclaw onboard  # 重新生成
```

### Q: 向量檢索沒結果？

確認向量資料庫連線和索引：
```bash
curl http://localhost:6333/collections/openclaw-memory
```

---

*文檔版本：1.0*
